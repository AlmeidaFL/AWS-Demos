# AWS API Gateway REST vs HTTP API Demo

This project demonstrates the differences between AWS API Gateway REST API and HTTP API by deploying both types with the same Lambda function backend. It showcases features like API keys, usage plans, throttling, and different event structures.

This comparison is useful for understanding when to choose REST API vs HTTP API based on your specific requirements and feature needs.

---

## Requirements

- AWS CLI installed and configured (aws configure)
- SAM CLI installed (optional, for local development)
- Sufficient permissions to create resources

---

## Project Structure

```
api-gateway-rest-vs-http-demo/
├── lambda/                 # Lambda function source code
│   └── app.js
├── template.yaml           # CloudFormation template (with Transform: SAM)
├── samconfig.toml          # SAM configuration file
├── packaged.yaml           # Generated by `cloudformation package` (ignored)
├── .aws-sam/              # SAM build artifacts (ignored)
├── .gitignore              # Excludes artifacts and local files
└── README.md               # Project instructions and documentation
```

---

## Step-by-Step Guide

### 1. Create an S3 Bucket (only once)

```bash
# S3 bucket is required (use your own unique bucket name)
aws s3 mb s3://unique-bucket-name --region your-region
```

### 2. Deploy the Stack

```bash
# Package SAM template
aws cloudformation package --template-file template.yaml --s3-bucket unique-bucket-name --output-template-file packaged.yaml

# Deploy stack
aws cloudformation deploy --template-file packaged.yaml --stack-name api-gateway-rest-vs-http-demo --capabilities CAPABILITY_IAM --region your-region
```

### 3. Testing the APIs

#### Get API URLs and API Key

```bash
# Get stack outputs
aws cloudformation describe-stacks --stack-name api-gateway-rest-vs-http-demo --query 'Stacks[0].Outputs'

# Get API Key value (needed for REST API with usage plan)
aws apigateway get-api-key --api-key YOUR_API_KEY_ID --include-value --query 'value' --output text
```

#### Test REST API

```bash
# Test REST API Hello endpoint (requires API key)
curl -H "X-API-Key: YOUR_API_KEY_VALUE" "https://YOUR_REST_API_ID.execute-api.YOUR_REGION.amazonaws.com/prod/hello/John?filter=recent&size=10"

# Test REST API Search endpoint (requires API key)
curl -H "X-API-Key: YOUR_API_KEY_VALUE" "https://YOUR_REST_API_ID.execute-api.YOUR_REGION.amazonaws.com/prod/search?filter=products&size=5"
```

#### Test HTTP API

```bash
# Test HTTP API Hello endpoint (API key required for this endpoint)
curl "https://YOUR_HTTP_API_ID.execute-api.YOUR_REGION.amazonaws.com/hello/Jane?filter=latest&size=20"

# Test HTTP API Search endpoint (no API key required)
curl "https://YOUR_HTTP_API_ID.execute-api.YOUR_REGION.amazonaws.com/search?filter=services&size=15"
```

### 4. Compare Event Structures

The Lambda function returns the complete event object, allowing you to see the differences between REST API and HTTP API event structures:

- **REST API**: More detailed event structure with extensive request context
- **HTTP API**: Simplified event structure optimized for performance

### 5. Test Usage Plan Limits (REST API only)

```bash
# Make multiple requests to test throttling (REST API has 10 requests/second rate limit)
for i in {1..15}; do
  curl -H "X-API-Key: YOUR_API_KEY_VALUE" "https://YOUR_REST_API_ID.execute-api.YOUR_REGION.amazonaws.com/prod/hello/test$i"
  echo "Request $i completed"
done
```

### 6. Clean Up Resources

```bash
# Delete the stack
aws cloudformation delete-stack --stack-name api-gateway-rest-vs-http-demo

# Wait for deletion to complete
aws cloudformation wait stack-delete-complete --stack-name api-gateway-rest-vs-http-demo
```

---

## Key Differences: REST API vs HTTP API

| Feature | REST API | HTTP API |
|---------|----------|----------|
| **Cost** | Higher | ~70% cheaper |
| **Performance** | Good | Better (lower latency) |
| **API Keys** | ✅ Supported | ✅ Supported |
| **Usage Plans** | ✅ Supported | ❌ Not supported |
| **Request Validation** | ✅ Supported | ❌ Not supported |
| **Caching** | ✅ Supported | ❌ Not supported |
| **WebSocket** | ❌ Not supported | ✅ Supported |
| **CORS Configuration** | Manual setup required | Simplified CORS |
| **Authorizers** | Multiple types | JWT and Lambda only |

---

## Important Security Notes

- **API Key Values**: For security reasons, API key values cannot be exposed through CloudFormation outputs. You must retrieve them using the AWS CLI command: `aws apigateway get-api-key --api-key YOUR_API_KEY_ID --include-value`
- **Production Usage**: Always use proper authentication mechanisms (Cognito, Lambda authorizers) instead of relying solely on API keys
- **Rate Limiting**: Implement appropriate throttling and quota limits to protect your APIs from abuse

---